
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../guilds/">
      
      
        <link rel="next" href="../execution/">
      
      
      <link rel="icon" href="../../assets/images/favicon.jpg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Messaging - Rustic AI Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/theme.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#messaging" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Rustic AI Documentation" class="md-header__button md-logo" aria-label="Rustic AI Documentation" data-md-component="logo">
      
  <img src="../../assets/images/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rustic AI Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Messaging
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/rustic-ai/rustic-ai" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Rustic AI Documentation" class="md-nav__button md-logo" aria-label="Rustic AI Documentation" data-md-component="logo">
      
  <img src="../../assets/images/logo.svg" alt="logo">

    </a>
    Rustic AI Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rustic-ai/rustic-ai" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Light Paper
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How-To Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            How-To Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/creating_your_first_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating Your First Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/creating_a_guild/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating a Guild
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/guild_specifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guild Specifications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/dependency_injection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dependency Injection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/state_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/testing_agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/writing_effective_agent_tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Writing Effective Agent Tests
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guilds/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guilds
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Messaging
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Messaging
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      Purpose
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Key Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messages" class="md-nav__link">
    <span class="md-ellipsis">
      Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topics" class="md-nav__link">
    <span class="md-ellipsis">
      Topics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clients" class="md-nav__link">
    <span class="md-ellipsis">
      Clients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backends" class="md-nav__link">
    <span class="md-ellipsis">
      Backends
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Message Schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-serialization-example" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Serialization Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#messaginginterface-the-message-bus" class="md-nav__link">
    <span class="md-ellipsis">
      MessagingInterface: The Message Bus
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MessagingInterface: The Message Bus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-management" class="md-nav__link">
    <span class="md-ellipsis">
      Client Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topic-subscription" class="md-nav__link">
    <span class="md-ellipsis">
      Topic Subscription
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-publishing" class="md-nav__link">
    <span class="md-ellipsis">
      Message Publishing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      Message Retrieval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-features" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespace-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Namespace Isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-history-enrichment" class="md-nav__link">
    <span class="md-ellipsis">
      Message History Enrichment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smart-subscription-management" class="md-nav__link">
    <span class="md-ellipsis">
      Smart Subscription Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#messagingbackend-storage-layer" class="md-nav__link">
    <span class="md-ellipsis">
      MessagingBackend: Storage Layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MessagingBackend: Storage Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Core Interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-backends" class="md-nav__link">
    <span class="md-ellipsis">
      Available Backends
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Available Backends">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inmemorymessagingbackend" class="md-nav__link">
    <span class="md-ellipsis">
      InMemoryMessagingBackend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embeddedmessagingbackend" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddedMessagingBackend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redismessagingbackend" class="md-nav__link">
    <span class="md-ellipsis">
      RedisMessagingBackend
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messagingconfig" class="md-nav__link">
    <span class="md-ellipsis">
      MessagingConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-backend-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Backend Creation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-flow-example" class="md-nav__link">
    <span class="md-ellipsis">
      Message Flow Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Flow Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cross-process-messaging-example" class="md-nav__link">
    <span class="md-ellipsis">
      Cross-Process Messaging Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-types" class="md-nav__link">
    <span class="md-ellipsis">
      Client Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Client Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messagetrackingclient-default" class="md-nav__link">
    <span class="md-ellipsis">
      MessageTrackingClient (Default)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simpleclient" class="md-nav__link">
    <span class="md-ellipsis">
      SimpleClient
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specialized-clients" class="md-nav__link">
    <span class="md-ellipsis">
      Specialized Clients
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-execution-engines" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Execution Engines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration with Execution Engines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution-engine-compatibility" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Engine Compatibility
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-engine-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Engine Responsibilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agent-wrapper-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Agent Wrapper Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Characteristics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Characteristics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messaginginterface-performance" class="md-nav__link">
    <span class="md-ellipsis">
      MessagingInterface Performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-performance-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Backend Performance Comparison
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#development" class="md-nav__link">
    <span class="md-ellipsis">
      Development
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    <span class="md-ellipsis">
      Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production" class="md-nav__link">
    <span class="md-ellipsis">
      Production
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-design" class="md-nav__link">
    <span class="md-ellipsis">
      Message Design
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Message Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-failures" class="md-nav__link">
    <span class="md-ellipsis">
      Backend Failures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-disconnection" class="md-nav__link">
    <span class="md-ellipsis">
      Client Disconnection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-and-observability" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring and Observability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring and Observability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#built-in-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Built-in Logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-support" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Support
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      Metrics (Recommended)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shared_memory_backend.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shared Memory Backend
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Execution
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiprocess_execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multiprocess Execution
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dependencies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../state_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State Management
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/guild_manager_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guild Manager Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/user_proxy_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Proxy Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/vector_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vector Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/simple_llm_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Simple LLM Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/probe_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Probe Agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    LiteLLM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            LiteLLM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/litellm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/litellm/litellm_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LiteLLM Agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    HuggingFace
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            HuggingFace
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/huggingface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/huggingface/llm_phi_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Phi Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/huggingface/squad_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Squad Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/huggingface/image2image_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image2Image Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/huggingface/runwayml_stable_diffusion_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runwayml Stable Diffusion Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/huggingface/speecht5_tts_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SpeechT5 TTS Agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Playwright
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Playwright
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/playwright/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/playwright/playwright_scraper_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Playwright Scraper Agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    SerpAPI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            SerpAPI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/serpapi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/serpapi/serp_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SERP Agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Marvin
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Marvin
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/marvin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/marvin/marvin_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Marvin Agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Dependencies
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Dependencies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/core/env_secret_provider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environment Secret Provider
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/core/filesystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File System Resolver
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/core/in_memory_kvstore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    In-Memory KV Store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/core/in_process_interpreter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    In-Process Interpreter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/core/python_exec_executor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python Exec Executor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Redis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Redis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/redis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/redis/redis_kvstore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Redis KV Store
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    LiteLLM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            LiteLLM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/litellm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/litellm/litellm_resolver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LiteLLM Resolver
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
        
          
          <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chroma
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            Chroma
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/chroma/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/chroma/chroma_resolver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chroma Resolver
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    LangChain
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            LangChain
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/langchain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/langchain/character_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Character Splitter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/langchain/openai_embeddings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAI Embeddings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/langchain/recursive_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Recursive Splitter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ray/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ray
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../showcase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Showcase
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ui_protocol_types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UI Protocol Types
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      Purpose
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Key Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messages" class="md-nav__link">
    <span class="md-ellipsis">
      Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topics" class="md-nav__link">
    <span class="md-ellipsis">
      Topics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clients" class="md-nav__link">
    <span class="md-ellipsis">
      Clients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backends" class="md-nav__link">
    <span class="md-ellipsis">
      Backends
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Message Schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-serialization-example" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Serialization Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#messaginginterface-the-message-bus" class="md-nav__link">
    <span class="md-ellipsis">
      MessagingInterface: The Message Bus
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MessagingInterface: The Message Bus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-management" class="md-nav__link">
    <span class="md-ellipsis">
      Client Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topic-subscription" class="md-nav__link">
    <span class="md-ellipsis">
      Topic Subscription
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-publishing" class="md-nav__link">
    <span class="md-ellipsis">
      Message Publishing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      Message Retrieval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-features" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespace-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Namespace Isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-history-enrichment" class="md-nav__link">
    <span class="md-ellipsis">
      Message History Enrichment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smart-subscription-management" class="md-nav__link">
    <span class="md-ellipsis">
      Smart Subscription Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#messagingbackend-storage-layer" class="md-nav__link">
    <span class="md-ellipsis">
      MessagingBackend: Storage Layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MessagingBackend: Storage Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Core Interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-backends" class="md-nav__link">
    <span class="md-ellipsis">
      Available Backends
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Available Backends">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inmemorymessagingbackend" class="md-nav__link">
    <span class="md-ellipsis">
      InMemoryMessagingBackend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embeddedmessagingbackend" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddedMessagingBackend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redismessagingbackend" class="md-nav__link">
    <span class="md-ellipsis">
      RedisMessagingBackend
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messagingconfig" class="md-nav__link">
    <span class="md-ellipsis">
      MessagingConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-backend-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Backend Creation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-flow-example" class="md-nav__link">
    <span class="md-ellipsis">
      Message Flow Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Flow Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cross-process-messaging-example" class="md-nav__link">
    <span class="md-ellipsis">
      Cross-Process Messaging Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-types" class="md-nav__link">
    <span class="md-ellipsis">
      Client Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Client Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messagetrackingclient-default" class="md-nav__link">
    <span class="md-ellipsis">
      MessageTrackingClient (Default)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simpleclient" class="md-nav__link">
    <span class="md-ellipsis">
      SimpleClient
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specialized-clients" class="md-nav__link">
    <span class="md-ellipsis">
      Specialized Clients
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-execution-engines" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Execution Engines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration with Execution Engines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution-engine-compatibility" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Engine Compatibility
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-engine-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Engine Responsibilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agent-wrapper-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Agent Wrapper Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Characteristics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Characteristics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messaginginterface-performance" class="md-nav__link">
    <span class="md-ellipsis">
      MessagingInterface Performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-performance-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Backend Performance Comparison
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#development" class="md-nav__link">
    <span class="md-ellipsis">
      Development
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    <span class="md-ellipsis">
      Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production" class="md-nav__link">
    <span class="md-ellipsis">
      Production
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-design" class="md-nav__link">
    <span class="md-ellipsis">
      Message Design
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Message Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-failures" class="md-nav__link">
    <span class="md-ellipsis">
      Backend Failures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-disconnection" class="md-nav__link">
    <span class="md-ellipsis">
      Client Disconnection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-and-observability" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring and Observability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring and Observability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#built-in-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Built-in Logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-support" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Support
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      Metrics (Recommended)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="messaging">Messaging<a class="headerlink" href="#messaging" title="Permanent link">&para;</a></h1>
<p>The messaging system in Rustic AI enables asynchronous, topic-based communication between agents within guilds. It provides a layered architecture with pluggable backends for different deployment scenarios, from development to distributed production systems.</p>
<h2 id="purpose">Purpose<a class="headerlink" href="#purpose" title="Permanent link">&para;</a></h2>
<ul>
<li>Facilitate communication between agents within and across guilds</li>
<li>Support topic-based publish/subscribe messaging with namespace isolation</li>
<li>Enable message persistence, retrieval, and real-time notifications</li>
<li>Provide pluggable storage backends for different deployment needs</li>
</ul>
<h2 id="architecture-overview">Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permanent link">&para;</a></h2>
<p>The messaging system consists of three main layers:</p>
<div class="highlight"><pre><span></span><code>┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│     Clients     │───▶│ MessagingInterface│───▶│ MessagingBackend│
│   (Agents)      │    │  (Message Bus)   │    │   (Storage)     │
└─────────────────┘    └──────────────────┘    └─────────────────┘
</code></pre></div>
<h2 id="key-concepts">Key Concepts<a class="headerlink" href="#key-concepts" title="Permanent link">&para;</a></h2>
<h3 id="messages">Messages<a class="headerlink" href="#messages" title="Permanent link">&para;</a></h3>
<p>Structured data packets exchanged between agents with the following key properties:
- <strong>Unique IDs</strong>: Generated using <code>GemstoneID</code> with embedded timestamp and priority
- <strong>Topics</strong>: Support single or multiple topic publishing
- <strong>Threading</strong>: Maintain conversation threads and message history
- <strong>Namespacing</strong>: Automatic namespace isolation per guild</p>
<h3 id="topics">Topics<a class="headerlink" href="#topics" title="Permanent link">&para;</a></h3>
<p>Channels for message delivery with automatic namespace prefixing:
- <strong>Guild Isolation</strong>: Each guild gets its own namespace (e.g., <code>guild-123:topic-name</code>)
- <strong>Subscription Management</strong>: Agents subscribe to topics to receive relevant messages
- <strong>Multi-Topic Publishing</strong>: Single message can be published to multiple topics</p>
<h3 id="clients">Clients<a class="headerlink" href="#clients" title="Permanent link">&para;</a></h3>
<p>Agents interact with the messaging system via client interfaces:
- <strong>MessageTrackingClient</strong>: Default client with message ordering and tracking
- <strong>SimpleClient</strong>: Basic client for simple use cases
- <strong>Specialized Clients</strong>: Pipeline, filtering, throttling, and other decorators</p>
<h3 id="backends">Backends<a class="headerlink" href="#backends" title="Permanent link">&para;</a></h3>
<p>Pluggable storage implementations:
- <strong>InMemoryMessagingBackend</strong>: Fast, in-memory storage for development/testing
- <strong>EmbeddedMessagingBackend</strong>: Embedded messaging for testing without external dependencies
- <strong>RedisMessagingBackend</strong>: Persistent, distributed storage for production
- <strong>Custom Backends</strong>: Implement <code>MessagingBackend</code> interface for specialized needs</p>
<h2 id="message-schema">Message Schema<a class="headerlink" href="#message-schema" title="Permanent link">&para;</a></h2>
<p>Every <code>Message</code> instance has the following structure:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Message</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="c1"># Core fields</span>
    <span class="n">sender</span><span class="p">:</span> <span class="n">AgentTag</span>                    <span class="c1"># Who sent the message</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>       <span class="c1"># Target topic(s)</span>
    <span class="n">payload</span><span class="p">:</span> <span class="n">JsonDict</span>                   <span class="c1"># Message content</span>
    <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span>                         <span class="c1"># Message format (default: &quot;generic_json&quot;)</span>

    <span class="c1"># Optional fields</span>
    <span class="n">recipient_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AgentTag</span><span class="p">]</span>      <span class="c1"># Tagged recipients</span>
    <span class="n">in_response_to</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>       <span class="c1"># Reply to message ID</span>
    <span class="n">thread</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>                   <span class="c1"># Conversation thread</span>
    <span class="n">conversation_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>      <span class="c1"># Conversation grouping</span>
    <span class="n">forward_header</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForwardHeader</span><span class="p">]</span>  <span class="c1"># Forwarding information</span>
    <span class="n">routing_slip</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RoutingSlip</span><span class="p">]</span> <span class="c1"># Multi-step routing</span>
    <span class="n">message_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ProcessEntry</span><span class="p">]</span> <span class="c1"># Processing history</span>
    <span class="n">ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>                  <span class="c1"># Time to live</span>

    <span class="c1"># Computed fields (read-only)</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>                            <span class="c1"># Unique message ID</span>
    <span class="n">priority</span><span class="p">:</span> <span class="n">Priority</span>                 <span class="c1"># Message priority (0-9)</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>                   <span class="c1"># Creation timestamp</span>
</code></pre></div>
<h3 id="json-serialization-example">JSON Serialization Example<a class="headerlink" href="#json-serialization-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123456789</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sender&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;agent-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Agent One&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;topics&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;updates&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hello, World!&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;generic_json&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;priority&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1640995200.123</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;thread&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">123456789</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;recipient_list&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;in_response_to&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;conversation_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;forward_header&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;routing_slip&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;message_history&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;ttl&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;is_error_message&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;traceparent&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;session_state&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;topic_published_to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;updates&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;enrich_with_history&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="messaginginterface-the-message-bus">MessagingInterface: The Message Bus<a class="headerlink" href="#messaginginterface-the-message-bus" title="Permanent link">&para;</a></h2>
<p>The <code>MessagingInterface</code> serves as the central message bus with the following responsibilities:</p>
<h3 id="client-management">Client Management<a class="headerlink" href="#client-management" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Register agent as messaging client</span>
<span class="n">messaging</span><span class="o">.</span><span class="n">register_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># Unregister when agent shuts down</span>
<span class="n">messaging</span><span class="o">.</span><span class="n">unregister_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div>
<h3 id="topic-subscription">Topic Subscription<a class="headerlink" href="#topic-subscription" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Subscribe agent to topic</span>
<span class="n">messaging</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s2">&quot;updates&quot;</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span>

<span class="c1"># Unsubscribe from topic</span>
<span class="n">messaging</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="s2">&quot;updates&quot;</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span>
</code></pre></div>
<h3 id="message-publishing">Message Publishing<a class="headerlink" href="#message-publishing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Publish message to topic(s)</span>
<span class="n">messaging</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">sender_client</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</code></pre></div>
<h3 id="message-retrieval">Message Retrieval<a class="headerlink" href="#message-retrieval" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Get all messages for a topic</span>
<span class="n">messages</span> <span class="o">=</span> <span class="n">messaging</span><span class="o">.</span><span class="n">get_messages</span><span class="p">(</span><span class="s2">&quot;updates&quot;</span><span class="p">)</span>

<span class="c1"># Get messages since specific ID</span>
<span class="n">recent_messages</span> <span class="o">=</span> <span class="n">messaging</span><span class="o">.</span><span class="n">get_messages_for_topic_since</span><span class="p">(</span><span class="s2">&quot;updates&quot;</span><span class="p">,</span> <span class="n">last_id</span><span class="p">)</span>

<span class="c1"># Get messages for a specific client across all subscribed topics</span>
<span class="n">client_messages</span> <span class="o">=</span> <span class="n">messaging</span><span class="o">.</span><span class="n">get_messages_for_client_since</span><span class="p">(</span><span class="n">client_id</span><span class="p">,</span> <span class="n">last_id</span><span class="p">)</span>
</code></pre></div>
<h3 id="advanced-features">Advanced Features<a class="headerlink" href="#advanced-features" title="Permanent link">&para;</a></h3>
<h4 id="namespace-isolation">Namespace Isolation<a class="headerlink" href="#namespace-isolation" title="Permanent link">&para;</a></h4>
<ul>
<li>Automatic topic prefixing: <code>topic</code> → <code>guild-123:topic</code></li>
<li>Prevents message leakage between guilds</li>
<li>Transparent to agents</li>
</ul>
<h4 id="message-history-enrichment">Message History Enrichment<a class="headerlink" href="#message-history-enrichment" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Messages can request conversation history</span>
<span class="n">message</span><span class="o">.</span><span class="n">enrich_with_history</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Include last 5 messages</span>
<span class="c1"># History automatically added to message.session_state[&quot;enriched_history&quot;]</span>
</code></pre></div>
<h4 id="smart-subscription-management">Smart Subscription Management<a class="headerlink" href="#smart-subscription-management" title="Permanent link">&para;</a></h4>
<ul>
<li>Lazy backend subscription (only when first client subscribes)</li>
<li>Reference counting (unsubscribe from backend when last client leaves)</li>
<li>Automatic cleanup on client disconnect</li>
</ul>
<h2 id="messagingbackend-storage-layer">MessagingBackend: Storage Layer<a class="headerlink" href="#messagingbackend-storage-layer" title="Permanent link">&para;</a></h2>
<p>The <code>MessagingBackend</code> abstract base class defines the interface for message storage:</p>
<h3 id="core-interface">Core Interface<a class="headerlink" href="#core-interface" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MessagingBackend</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">store_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store a message in the backend&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_messages_for_topic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all messages for a topic&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_messages_for_topic_since</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg_id_since</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve messages since a specific ID&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Message</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subscribe to real-time notifications&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_messages_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Batch retrieve messages by ID&quot;&quot;&quot;</span>
</code></pre></div>
<h3 id="available-backends">Available Backends<a class="headerlink" href="#available-backends" title="Permanent link">&para;</a></h3>
<h4 id="inmemorymessagingbackend">InMemoryMessagingBackend<a class="headerlink" href="#inmemorymessagingbackend" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Configuration</span>
<span class="n">MessagingConfig</span><span class="p">(</span>
    <span class="n">backend_module</span><span class="o">=</span><span class="s2">&quot;rustic_ai.core.messaging.backend&quot;</span><span class="p">,</span>
    <span class="n">backend_class</span><span class="o">=</span><span class="s2">&quot;InMemoryMessagingBackend&quot;</span><span class="p">,</span>
    <span class="n">backend_config</span><span class="o">=</span><span class="p">{}</span>
<span class="p">)</span>
</code></pre></div>
<p><strong>Features:</strong></p>
<ul>
<li><strong>Performance</strong>: Extremely fast in-memory operations</li>
<li><strong>Real-time</strong>: Immediate callback-based notifications</li>
<li><strong>Singleton</strong>: Shared state across multiple interface instances</li>
<li><strong>Development</strong>: Perfect for testing and development</li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li><strong>Not Persistent</strong>: Data lost on restart</li>
<li><strong>Single Process</strong>: Cannot share across processes</li>
<li><strong>Memory Bound</strong>: Limited by available RAM</li>
</ul>
<h4 id="embeddedmessagingbackend">EmbeddedMessagingBackend<a class="headerlink" href="#embeddedmessagingbackend" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Configuration with auto-start server</span>
<span class="n">MessagingConfig</span><span class="p">(</span>
    <span class="n">backend_module</span><span class="o">=</span><span class="s2">&quot;rustic_ai.core.messaging.backend.embedded_backend&quot;</span><span class="p">,</span>
    <span class="n">backend_class</span><span class="o">=</span><span class="s2">&quot;EmbeddedMessagingBackend&quot;</span><span class="p">,</span>
    <span class="n">backend_config</span><span class="o">=</span><span class="p">{}</span>
<span class="p">)</span>

<span class="c1"># Configuration with external server</span>
<span class="n">MessagingConfig</span><span class="p">(</span>
    <span class="n">backend_module</span><span class="o">=</span><span class="s2">&quot;rustic_ai.core.messaging.backend.embedded_backend&quot;</span><span class="p">,</span>
    <span class="n">backend_class</span><span class="o">=</span><span class="s2">&quot;EmbeddedMessagingBackend&quot;</span><span class="p">,</span>
    <span class="n">backend_config</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">31134</span><span class="p">,</span>
        <span class="s2">&quot;auto_start_server&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p><strong>Features:</strong></p>
<ul>
<li><strong>Cross-Process</strong>: Enables communication between separate processes</li>
<li><strong>Socket-Based</strong>: Fast TCP socket communication with asyncio</li>
<li><strong>No External Dependencies</strong>: Uses only Python standard library</li>
<li><strong>Real-time Subscriptions</strong>: True push delivery with asyncio</li>
<li><strong>Message TTL</strong>: Automatic message expiration</li>
<li><strong>Auto-cleanup</strong>: Automatic resource management and cleanup</li>
<li><strong>Back-pressure Handling</strong>: Per-connection queues with overflow protection</li>
<li><strong>Testing Focused</strong>: Ideal for testing multiprocess scenarios</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li><strong>Multiprocess Testing</strong>: Test agents running in separate processes</li>
<li><strong>Development</strong>: Fast messaging without external setup</li>
<li><strong>CI/CD</strong>: Testing distributed scenarios without infrastructure</li>
<li><strong>Process Isolation</strong>: When you need true process separation</li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li><strong>Memory Only</strong>: Data not persisted to disk</li>
<li><strong>Single Server</strong>: No clustering or high availability</li>
<li><strong>Testing Scope</strong>: Designed for testing rather than production</li>
</ul>
<h4 id="redismessagingbackend">RedisMessagingBackend<a class="headerlink" href="#redismessagingbackend" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Configuration</span>
<span class="n">MessagingConfig</span><span class="p">(</span>
    <span class="n">backend_module</span><span class="o">=</span><span class="s2">&quot;rustic_ai.redis.messaging.backend&quot;</span><span class="p">,</span>
    <span class="n">backend_class</span><span class="o">=</span><span class="s2">&quot;RedisMessagingBackend&quot;</span><span class="p">,</span>
    <span class="n">backend_config</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;redis_client&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">6379</span><span class="p">,</span>
            <span class="s2">&quot;ssl&quot;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p><strong>Features:</strong></p>
<ul>
<li><strong>Persistent</strong>: Data survives restarts</li>
<li><strong>Distributed</strong>: Shared across processes and machines</li>
<li><strong>Scalable</strong>: Redis clustering support</li>
<li><strong>Real-time</strong>: Redis pub/sub for notifications</li>
<li><strong>TTL Support</strong>: Configurable message expiration</li>
<li><strong>Efficient</strong>: Pipeline operations for batch processing</li>
</ul>
<p><strong>Storage Strategy:</strong></p>
<ul>
<li><strong>Sorted Sets</strong>: Messages stored with timestamp scores for ordering</li>
<li><strong>Secondary Index</strong>: Direct ID lookup via <code>msg:namespace:id</code> keys</li>
<li><strong>Pub/Sub</strong>: Real-time notifications via Redis pub/sub</li>
</ul>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<h3 id="messagingconfig">MessagingConfig<a class="headerlink" href="#messagingconfig" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MessagingConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">backend_module</span><span class="p">:</span> <span class="nb">str</span>      <span class="c1"># Python module containing backend</span>
    <span class="n">backend_class</span><span class="p">:</span> <span class="nb">str</span>       <span class="c1"># Backend class name</span>
    <span class="n">backend_config</span><span class="p">:</span> <span class="n">Dict</span>     <span class="c1"># Backend-specific configuration</span>
</code></pre></div>
<h3 id="dynamic-backend-creation">Dynamic Backend Creation<a class="headerlink" href="#dynamic-backend-creation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># MessagingConfig automatically creates backend instances</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">MessagingConfig</span><span class="p">(</span>
    <span class="n">backend_module</span><span class="o">=</span><span class="s2">&quot;rustic_ai.core.messaging.backend&quot;</span><span class="p">,</span>
    <span class="n">backend_class</span><span class="o">=</span><span class="s2">&quot;InMemoryMessagingBackend&quot;</span><span class="p">,</span>
    <span class="n">backend_config</span><span class="o">=</span><span class="p">{}</span>
<span class="p">)</span>

<span class="c1"># Socket messaging backend helper</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.messaging.backend.embedded_backend</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_embedded_messaging_config</span>
<span class="n">embedded_config</span> <span class="o">=</span> <span class="n">create_embedded_messaging_config</span><span class="p">()</span>

<span class="c1"># MessagingInterface uses config to create backend</span>
<span class="n">messaging</span> <span class="o">=</span> <span class="n">MessagingInterface</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;guild-123&quot;</span><span class="p">,</span> <span class="n">messaging_config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>
<h2 id="message-flow-example">Message Flow Example<a class="headerlink" href="#message-flow-example" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. Agent A sends message</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span>
    <span class="n">id_obj</span><span class="o">=</span><span class="n">generator</span><span class="o">.</span><span class="n">get_id</span><span class="p">(</span><span class="n">Priority</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">),</span>
    <span class="n">sender</span><span class="o">=</span><span class="n">AgentTag</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;agent-a&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Agent A&quot;</span><span class="p">),</span>
    <span class="n">topics</span><span class="o">=</span><span class="s2">&quot;updates&quot;</span><span class="p">,</span>
    <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello, Agent B!&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># 2. Publish via messaging interface</span>
<span class="n">messaging_interface</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">client_a</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

<span class="c1"># 3. MessagingInterface processes:</span>
<span class="c1">#    - Adds namespace prefix: &quot;updates&quot; → &quot;guild-123:updates&quot;</span>
<span class="c1">#    - Stores in backend</span>
<span class="c1">#    - Notifies subscribers</span>

<span class="c1"># 4. Backend stores and notifies:</span>
<span class="c1">#    - InMemory: Immediate callback</span>
<span class="c1">#    - SocketMessaging: Socket push delivery</span>
<span class="c1">#    - Redis: Pub/sub notification</span>

<span class="c1"># 5. Agent B receives message:</span>
<span class="c1">#    - Client notified via callback</span>
<span class="c1">#    - Message delivered to agent&#39;s message handler</span>
</code></pre></div>
<h3 id="cross-process-messaging-example">Cross-Process Messaging Example<a class="headerlink" href="#cross-process-messaging-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Process 1: Setup embedded messaging backend with MultiProcessExecutionEngine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.messaging.backend.embedded_backend</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_embedded_messaging_config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.guild.execution.multiprocess</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultiProcessExecutionEngine</span>

<span class="c1"># Create messaging config for cross-process communication</span>
<span class="n">messaging_config</span> <span class="o">=</span> <span class="n">create_embedded_messaging_config</span><span class="p">()</span>

<span class="c1"># Create guild with multiprocess execution</span>
<span class="n">guild</span> <span class="o">=</span> <span class="n">Guild</span><span class="p">(</span>
    <span class="n">guild_id</span><span class="o">=</span><span class="s2">&quot;distributed-guild&quot;</span><span class="p">,</span>
    <span class="n">execution_engine</span><span class="o">=</span><span class="n">MultiProcessExecutionEngine</span><span class="p">(</span><span class="n">guild_id</span><span class="o">=</span><span class="s2">&quot;distributed-guild&quot;</span><span class="p">),</span>
    <span class="n">messaging_config</span><span class="o">=</span><span class="n">messaging_config</span>
<span class="p">)</span>

<span class="c1"># Launch agents in separate processes</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">agent_spec</span> <span class="o">=</span> <span class="n">create_worker_agent_spec</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;worker-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">guild</span><span class="o">.</span><span class="n">launch_agent</span><span class="p">(</span><span class="n">agent_spec</span><span class="p">)</span>

<span class="c1"># Agents can now communicate across processes via socket messaging backend</span>
<span class="c1"># - No Redis setup required</span>
<span class="c1"># - Process isolation maintained</span>
<span class="c1"># - Real-time messaging via socket push delivery</span>
</code></pre></div>
<h2 id="client-types">Client Types<a class="headerlink" href="#client-types" title="Permanent link">&para;</a></h2>
<h3 id="messagetrackingclient-default">MessageTrackingClient (Default)<a class="headerlink" href="#messagetrackingclient-default" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MessageTrackingClient</span><span class="p">(</span><span class="n">Client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tracks message processing with ordering and deduplication&quot;&quot;&quot;</span>
</code></pre></div>
<ul>
<li><strong>Message Ordering</strong>: Processes messages in ID order</li>
<li><strong>Tracking</strong>: Tracks last processed message ID</li>
<li><strong>Threading</strong>: Uses events and heaps for efficient processing</li>
</ul>
<h3 id="simpleclient">SimpleClient<a class="headerlink" href="#simpleclient" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimpleClient</span><span class="p">(</span><span class="n">Client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Basic client for simple messaging needs&quot;&quot;&quot;</span>
</code></pre></div>
- <strong>Lightweight</strong>: Minimal overhead
- <strong>Direct</strong>: Immediate message processing</p>
<h3 id="specialized-clients">Specialized Clients<a class="headerlink" href="#specialized-clients" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>PipelineClient</strong>: Chain multiple processing steps</li>
<li><strong>FilteringClient</strong>: Filter messages based on criteria</li>
<li><strong>ThrottlingClient</strong>: Rate-limit message processing</li>
<li><strong>RetryingClient</strong>: Automatic retry on failures</li>
<li><strong>LoggingClient</strong>: Add logging to message processing</li>
</ul>
<h2 id="integration-with-execution-engines">Integration with Execution Engines<a class="headerlink" href="#integration-with-execution-engines" title="Permanent link">&para;</a></h2>
<h3 id="execution-engine-compatibility">Execution Engine Compatibility<a class="headerlink" href="#execution-engine-compatibility" title="Permanent link">&para;</a></h3>
<p>Different execution engines work optimally with different messaging backends:</p>
<table>
<thead>
<tr>
<th>Execution Engine</th>
<th>Recommended Backend</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SyncExecutionEngine</code></td>
<td><code>InMemoryMessagingBackend</code></td>
<td>Fast, single-process operation</td>
</tr>
<tr>
<td><code>MultiThreadedEngine</code></td>
<td><code>InMemoryMessagingBackend</code> or <code>RedisMessagingBackend</code></td>
<td>Thread-safe with shared memory</td>
</tr>
<tr>
<td><code>MultiProcessExecutionEngine</code></td>
<td><strong><code>EmbeddedMessagingBackend</code></strong> or <code>RedisMessagingBackend</code></td>
<td>Cross-process communication</td>
</tr>
<tr>
<td><code>RayExecutionEngine</code></td>
<td><code>RedisMessagingBackend</code></td>
<td>Distributed messaging</td>
</tr>
</tbody>
</table>
<p>The <strong>EmbeddedMessagingBackend</strong> is particularly well-suited for the <code>MultiProcessExecutionEngine</code> because:
- <strong>No External Dependencies</strong>: Works without Redis setup
- <strong>Process Isolation</strong>: Each process gets proper isolation while maintaining communication
- <strong>Testing Friendly</strong>: Ideal for testing distributed scenarios in CI/CD
- <strong>Redis-like Features</strong>: Provides coordination primitives for process synchronization</p>
<h3 id="execution-engine-responsibilities">Execution Engine Responsibilities<a class="headerlink" href="#execution-engine-responsibilities" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Configuration</strong>: Provide <code>MessagingConfig</code> to agent wrappers</li>
<li><strong>Lifecycle</strong>: Coordinate messaging setup during agent initialization</li>
<li><strong>Isolation</strong>: Each agent gets its own messaging client</li>
</ul>
<h3 id="agent-wrapper-integration">Agent Wrapper Integration<a class="headerlink" href="#agent-wrapper-integration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AgentWrapper</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">initialize_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Create MessagingInterface from config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messaging</span> <span class="o">=</span> <span class="n">MessagingInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">guild_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">messaging_config</span><span class="p">)</span>

        <span class="c1"># Create and register client</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_type</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">message_handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">_on_message</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messaging</span><span class="o">.</span><span class="n">register_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

        <span class="c1"># Subscribe to agent&#39;s topics</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">subscribed_topics</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">messaging</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span>
</code></pre></div>
<h2 id="performance-characteristics">Performance Characteristics<a class="headerlink" href="#performance-characteristics" title="Permanent link">&para;</a></h2>
<h3 id="messaginginterface-performance">MessagingInterface Performance<a class="headerlink" href="#messaginginterface-performance" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Client Lookup</strong>: O(1) by client ID</li>
<li><strong>Topic Subscription</strong>: O(1) for subscription management</li>
<li><strong>Message Copying</strong>: Deep copies for isolation (memory overhead)</li>
<li><strong>Namespace Processing</strong>: O(1) string operations</li>
</ul>
<h3 id="backend-performance-comparison">Backend Performance Comparison<a class="headerlink" href="#backend-performance-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>InMemoryBackend</th>
<th>EmbeddedMessagingBackend</th>
<th>RedisBackend</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Latency</strong></td>
<td>~1μs</td>
<td>~0.1-1ms</td>
<td>~1-10ms</td>
</tr>
<tr>
<td><strong>Throughput</strong></td>
<td>Very High</td>
<td>Very High</td>
<td>High</td>
</tr>
<tr>
<td><strong>Persistence</strong></td>
<td>None</td>
<td>None</td>
<td>Full</td>
</tr>
<tr>
<td><strong>Scalability</strong></td>
<td>Single Process</td>
<td>Multi-Process</td>
<td>Distributed</td>
</tr>
<tr>
<td><strong>Memory Usage</strong></td>
<td>High (all in RAM)</td>
<td>Medium (socket overhead)</td>
<td>Low (Redis manages)</td>
</tr>
<tr>
<td><strong>Real-time</strong></td>
<td>Immediate</td>
<td>Push delivery</td>
<td>Near real-time</td>
</tr>
<tr>
<td><strong>Cross-Process</strong></td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>External Dependencies</strong></td>
<td>None</td>
<td>None</td>
<td>Redis Server</td>
</tr>
</tbody>
</table>
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<h3 id="development">Development<a class="headerlink" href="#development" title="Permanent link">&para;</a></h3>
<ul>
<li>Use <code>InMemoryMessagingBackend</code> for fast iteration and single-process testing</li>
<li>Use <code>EmbeddedMessagingBackend</code> for testing multiprocess scenarios and process isolation</li>
<li>Enable debug logging for message flow visibility</li>
<li>Use <code>SyncExecutionEngine</code> for deterministic testing</li>
</ul>
<h3 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h3>
<ul>
<li>Use <code>EmbeddedMessagingBackend</code> with <code>MultiProcessExecutionEngine</code> for realistic testing</li>
<li>Leverage embedded messaging backend's message-based operations for test coordination</li>
<li>Use real-time subscriptions for responsive test monitoring</li>
<li>Take advantage of automatic cleanup for test isolation</li>
</ul>
<h3 id="production">Production<a class="headerlink" href="#production" title="Permanent link">&para;</a></h3>
<ul>
<li>Use <code>RedisMessagingBackend</code> for persistence and scalability</li>
<li>Configure appropriate message TTL to manage storage</li>
<li>Use <code>MultiThreadedEngine</code> or <code>RayExecutionEngine</code> for concurrency</li>
<li>Monitor Redis memory usage and performance</li>
</ul>
<h3 id="message-design">Message Design<a class="headerlink" href="#message-design" title="Permanent link">&para;</a></h3>
<ul>
<li>Keep payloads reasonably sized (&lt; 1MB recommended)</li>
<li>Use meaningful topic names with clear hierarchy</li>
<li>Include correlation IDs for request/response patterns</li>
<li>Leverage message threading for conversation tracking</li>
</ul>
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<h3 id="message-validation">Message Validation<a class="headerlink" href="#message-validation" title="Permanent link">&para;</a></h3>
<ul>
<li>Pydantic-based validation for message structure</li>
<li>Automatic type checking and conversion</li>
<li>Clear error messages for invalid data</li>
</ul>
<h3 id="backend-failures">Backend Failures<a class="headerlink" href="#backend-failures" title="Permanent link">&para;</a></h3>
<ul>
<li>MessagingInterface handles backend initialization errors</li>
<li>Graceful degradation when backend unavailable</li>
<li>Proper cleanup on shutdown</li>
</ul>
<h3 id="client-disconnection">Client Disconnection<a class="headerlink" href="#client-disconnection" title="Permanent link">&para;</a></h3>
<ul>
<li>Automatic cleanup of subscriptions</li>
<li>Resource cleanup on client disconnect</li>
<li>Graceful handling of client failures</li>
</ul>
<h2 id="monitoring-and-observability">Monitoring and Observability<a class="headerlink" href="#monitoring-and-observability" title="Permanent link">&para;</a></h2>
<h3 id="built-in-logging">Built-in Logging<a class="headerlink" href="#built-in-logging" title="Permanent link">&para;</a></h3>
<ul>
<li>Structured logging for message flow</li>
<li>Debug-level logging for detailed tracing</li>
<li>Error logging for failure scenarios</li>
</ul>
<h3 id="opentelemetry-support">OpenTelemetry Support<a class="headerlink" href="#opentelemetry-support" title="Permanent link">&para;</a></h3>
<ul>
<li>Trace context propagation via <code>traceparent</code> field</li>
<li>Distributed tracing across agent interactions</li>
<li>Integration with observability platforms</li>
</ul>
<h3 id="metrics-recommended">Metrics (Recommended)<a class="headerlink" href="#metrics-recommended" title="Permanent link">&para;</a></h3>
<ul>
<li>Message throughput per topic</li>
<li>Client subscription counts</li>
<li>Backend performance metrics</li>
<li>Error rates and types</li>
</ul>
<blockquote>
<p>See the <a href="../execution/">Execution</a> section for how messaging integrates with execution engines, <a href="../embedded_messaging_backend/">Embedded Messaging Backend</a> for detailed information about cross-process messaging, and <a href="../agents/">Agents</a> for agent-specific messaging patterns. </p>
</blockquote>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>