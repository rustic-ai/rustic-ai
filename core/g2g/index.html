
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../guilds/">
      
      
        <link rel="next" href="../messaging/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.jpg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Guild-to-Guild (G2G) - Rustic AI Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/theme.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#guild-to-guild-g2g-communication" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Rustic AI Documentation" class="md-header__button md-logo" aria-label="Rustic AI Documentation" data-md-component="logo">
      
  <img src="../../assets/images/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rustic AI Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Guild-to-Guild (G2G)
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/rustic-ai/rustic-ai" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Rustic AI Documentation" class="md-nav__button md-logo" aria-label="Rustic AI Documentation" data-md-component="logo">
      
  <img src="../../assets/images/logo.svg" alt="logo">

    </a>
    Rustic AI Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rustic-ai/rustic-ai" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Light Paper
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    How-To Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    How-To Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/creating_your_first_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Creating Your First Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/creating_a_guild/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Creating a Guild
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/guild_specifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guild Specifications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/dependency_injection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dependency Injection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/state_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    State Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/using_react_agent_with_skills/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using ReActAgent with Skills
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/testing_agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/writing_effective_agent_tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Writing Effective Agent Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/client_server_flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client-Server Flow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/code_tag_quick_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Tag Quick Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/llm_prompts_with_code_tag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Prompts with Code Tag
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_13" >
        
          
          <label class="md-nav__link" for="__nav_3_13" id="__nav_3_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/examples/code_review_prompt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Review Prompt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/examples/prompts/security_reviewer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Reviewer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guilds/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guilds
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Guild-to-Guild (G2G)
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Guild-to-Guild (G2G)
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-flow-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Flow Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Concepts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#boundaryagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        BoundaryAgent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gatewayagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        GatewayAgent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GatewayAgent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gatewayagent-message-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      
        GatewayAgent Message Handlers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-gatewayagent-via-gatewayconfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automatic GatewayAgent via GatewayConfig
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#envoyagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        EnvoyAgent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boundarycontext" class="md-nav__link">
    <span class="md-ellipsis">
      
        BoundaryContext
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boundaryclient" class="md-nav__link">
    <span class="md-ellipsis">
      
        BoundaryClient
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-hop-routing-with-origin-guild-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Hop Routing with Origin Guild Stack
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multi-Hop Routing with Origin Guild Stack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-the-stack-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How the Stack Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stack-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stack Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-hop-flow-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Hop Flow Diagram
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-format-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Format Filtering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Format Filtering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gatewayagent-formats" class="md-nav__link">
    <span class="md-ellipsis">
      
        GatewayAgent Formats
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#envoyagent-formats" class="md-nav__link">
    <span class="md-ellipsis">
      
        EnvoyAgent Formats
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security &amp; Access Control
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security &amp; Access Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-format-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Format Filtering
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-organization-namespace-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Organization Namespace Isolation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-example-two-guild-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complete Example: Two-Guild Communication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Example: Two-Guild Communication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#guild-a-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        Guild A (Client)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guild-b-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Guild B (Server)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sending-a-request" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sending a Request
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-use-specific-format-names" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Use Specific Format Names
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-configure-both-sides" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Configure Both Sides
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-use-explicit-format-filters" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Use Explicit Format Filters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-handle-errors-at-boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Handle Errors at Boundaries
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-monitor-cross-guild-traffic" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Monitor Cross-Guild Traffic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-use-session-state-for-request-response-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Use Session State for Request-Response Correlation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-not-reaching-target-guild" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Not Reaching Target Guild
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-not-returning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Response Not Returning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-hop-routing-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Hop Routing Issues
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saga-pattern-session-state-preservation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Saga Pattern: Session State Preservation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Saga Pattern: Session State Preservation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How It Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guildstackentry-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        GuildStackEntry Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Usage Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-points" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Points
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-hop-saga-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Hop Saga State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#low-level-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Low-Level API
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exported-from-rustic_aicoreguildg2g" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exported from rustic_ai.core.guild.g2g
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Fields
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      
        See Also
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../messaging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Messaging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../messaging_lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Messaging Lifecycle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiprocess_execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multiprocess Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dependencies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../state_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    State Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Agents
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Agents
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Agents.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agents Deep Dive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/llm_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Agent & Plugins
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/llm_agent_memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Agent Memory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/llm_agent_plugins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Agent Plugins
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/react_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ReAct Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/guild_manager_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guild Manager Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/user_proxy_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    User Proxy Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/vector_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vector Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/knowledge_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/simple_llm_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Simple LLM Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/core/probe_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Probe Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    LiteLLM
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    LiteLLM
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/litellm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/litellm/litellm_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LiteLLM Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_9" >
        
          
          <label class="md-nav__link" for="__nav_5_9" id="__nav_5_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    HuggingFace
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    HuggingFace
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/huggingface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/huggingface/llm_phi_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Phi Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/huggingface/squad_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Squad Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/huggingface/image2image_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Image2Image Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/huggingface/runwayml_stable_diffusion_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runwayml Stable Diffusion Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/huggingface/speecht5_tts_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SpeechT5 TTS Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" >
        
          
          <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Playwright
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Playwright
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/playwright/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/playwright/playwright_scraper_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Playwright Scraper Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_11" >
        
          
          <label class="md-nav__link" for="__nav_5_11" id="__nav_5_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    SerpAPI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    SerpAPI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/serpapi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/serpapi/serp_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SERP Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_12" >
        
          
          <label class="md-nav__link" for="__nav_5_12" id="__nav_5_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Marvin
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Marvin
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/marvin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/marvin/marvin_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Marvin Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_13" >
        
          
          <label class="md-nav__link" for="__nav_5_13" id="__nav_5_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    MCP
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    MCP
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Dependencies
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Dependencies
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/core/env_secret_provider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environment Secret Provider
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/core/filesystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File System Resolver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/core/in_memory_kvstore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    In-Memory KV Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/core/in_process_interpreter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    In-Process Interpreter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/core/python_exec_executor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Exec Executor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Redis
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Redis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/redis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/redis/redis_kvstore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis KV Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    LiteLLM
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    LiteLLM
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/litellm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/litellm/litellm_resolver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LiteLLM Resolver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
        
          
          <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Chroma
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Chroma
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/chroma/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/chroma/chroma_resolver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chroma Resolver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    LangChain
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    LangChain
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/langchain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/langchain/character_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Character Splitter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/langchain/openai_embeddings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OpenAI Embeddings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/langchain/recursive_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Recursive Splitter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Skills
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Skills
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Patterns
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Patterns
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/messaging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Messaging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/transformation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transformation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/aggregation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Aggregation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ray/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ray
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../showcase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Showcase
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ui_protocol_types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UI Protocol Types
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Design
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    Design
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/react-agent-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ReAct Agent Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-flow-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Flow Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Concepts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#boundaryagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        BoundaryAgent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gatewayagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        GatewayAgent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GatewayAgent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gatewayagent-message-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      
        GatewayAgent Message Handlers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-gatewayagent-via-gatewayconfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automatic GatewayAgent via GatewayConfig
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#envoyagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        EnvoyAgent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boundarycontext" class="md-nav__link">
    <span class="md-ellipsis">
      
        BoundaryContext
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boundaryclient" class="md-nav__link">
    <span class="md-ellipsis">
      
        BoundaryClient
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-hop-routing-with-origin-guild-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Hop Routing with Origin Guild Stack
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multi-Hop Routing with Origin Guild Stack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-the-stack-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How the Stack Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stack-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stack Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-hop-flow-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Hop Flow Diagram
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-format-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Format Filtering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Format Filtering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gatewayagent-formats" class="md-nav__link">
    <span class="md-ellipsis">
      
        GatewayAgent Formats
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#envoyagent-formats" class="md-nav__link">
    <span class="md-ellipsis">
      
        EnvoyAgent Formats
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security &amp; Access Control
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security &amp; Access Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-format-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Format Filtering
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-organization-namespace-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Organization Namespace Isolation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-example-two-guild-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complete Example: Two-Guild Communication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Example: Two-Guild Communication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#guild-a-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        Guild A (Client)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guild-b-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Guild B (Server)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sending-a-request" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sending a Request
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-use-specific-format-names" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Use Specific Format Names
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-configure-both-sides" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Configure Both Sides
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-use-explicit-format-filters" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Use Explicit Format Filters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-handle-errors-at-boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Handle Errors at Boundaries
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-monitor-cross-guild-traffic" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Monitor Cross-Guild Traffic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-use-session-state-for-request-response-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Use Session State for Request-Response Correlation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-not-reaching-target-guild" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Not Reaching Target Guild
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-not-returning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Response Not Returning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-hop-routing-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Hop Routing Issues
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saga-pattern-session-state-preservation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Saga Pattern: Session State Preservation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Saga Pattern: Session State Preservation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How It Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guildstackentry-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        GuildStackEntry Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Usage Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-points" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Points
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-hop-saga-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Hop Saga State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#low-level-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Low-Level API
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exported-from-rustic_aicoreguildg2g" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exported from rustic_ai.core.guild.g2g
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Fields
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      
        See Also
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="guild-to-guild-g2g-communication">Guild-to-Guild (G2G) Communication<a class="headerlink" href="#guild-to-guild-g2g-communication" title="Permanent link">&para;</a></h1>
<p>Guild-to-Guild (G2G) communication enables secure, structured messaging between independent guilds in Rustic AI. This allows you to build microservice-style architectures where specialized guilds can collaborate while maintaining isolation and encapsulation.</p>
<h2 id="purpose">Purpose<a class="headerlink" href="#purpose" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Service Composition</strong>: Connect specialized guilds (e.g., a "Research Guild" calling a "Database Guild")</li>
<li><strong>Isolation</strong>: Maintain guild boundaries while enabling collaboration</li>
<li><strong>Multi-Hop Routing</strong>: Support complex workflows spanning multiple guilds (A  B  C  B  A)</li>
<li><strong>Security</strong>: Control what message types are allowed across boundaries via format filtering</li>
<li><strong>Scalability</strong>: Guilds can be deployed independently and communicate across process/network boundaries</li>
</ul>
<h2 id="architecture-overview">Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permanent link">&para;</a></h2>
<p>G2G communication uses a <strong>shared namespace</strong> that exists outside individual guild namespaces. Each guild has a unique inbox topic in this shared namespace where other guilds can send messages.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>flowchart TB
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    subgraph org[&quot;Organization Namespace (Shared)&quot;]
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        inbox_a[&quot;guild_inbox:A&quot;]
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        inbox_b[&quot;guild_inbox:B&quot;]
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        inbox_c[&quot;guild_inbox:C&quot;]
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    end
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    subgraph guild_a[&quot;Guild A (Client)&quot;]
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>        direction TB
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>        gw_a[&quot;GatewayAgent&quot;]
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>        env_a[&quot;EnvoyAgent&quot;]
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>        agents_a[&quot;Processing Agents&quot;]
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        probe_a[&quot;ProbeAgent&quot;]
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>        probe_a --&gt;|&quot;1. send request&quot;| env_a
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>        gw_a --&gt;|&quot;8. forward response&quot;| probe_a
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    end
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    subgraph guild_b[&quot;Guild B (Middle Tier)&quot;]
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>        direction TB
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>        gw_b[&quot;GatewayAgent&quot;]
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>        env_b[&quot;EnvoyAgent&quot;]
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>        agents_b[&quot;Processing Agents&quot;]
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>        gw_b --&gt;|&quot;3. forward internally&quot;| env_b
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>        gw_b --&gt;|&quot;6. forward internally&quot;| agents_b
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>        agents_b --&gt;|&quot;7. response ready&quot;| gw_b
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>    end
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>    subgraph guild_c[&quot;Guild C (Backend)&quot;]
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>        direction TB
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>        gw_c[&quot;GatewayAgent&quot;]
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>        responder_c[&quot;ResponderAgent&quot;]
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>        gw_c --&gt;|&quot;4. forward internally&quot;| responder_c
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>        responder_c --&gt;|&quot;5. send response&quot;| gw_c
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>    end
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    %% Forward path (requests)
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>    env_a ==&gt;|&quot;2. request\nstack: [A]&quot;| inbox_b
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>    inbox_b -.-&gt;|&quot;subscribe&quot;| gw_b
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>    env_b ==&gt;|&quot;3. request\nstack: [A,B]&quot;| inbox_c
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    inbox_c -.-&gt;|&quot;subscribe&quot;| gw_c
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>    %% Return path (responses)
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>    gw_c ==&gt;|&quot;5. response\nstack: [A,B]&quot;| inbox_b
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>    gw_b ==&gt;|&quot;7. response\nstack: [A]&quot;| inbox_a
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>    inbox_a -.-&gt;|&quot;subscribe&quot;| gw_a
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>    %% Styling
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>    classDef gateway fill:#e1f5fe,stroke:#01579b
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>    classDef envoy fill:#fff3e0,stroke:#e65100
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>    classDef agent fill:#f3e5f5,stroke:#4a148c
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>    classDef inbox fill:#e8f5e9,stroke:#1b5e20
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>    classDef namespace fill:#fafafa,stroke:#424242
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>    class gw_a,gw_b,gw_c gateway
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>    class env_a,env_b envoy
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a>    class agents_a,agents_b,responder_c,probe_a agent
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>    class inbox_a,inbox_b,inbox_c inbox
</code></pre></div>
<h3 id="message-flow-summary">Message Flow Summary<a class="headerlink" href="#message-flow-summary" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Step</th>
<th>Action</th>
<th>Stack State</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Agent in Guild A sends request</td>
<td><code>[]</code></td>
</tr>
<tr>
<td>2</td>
<td>Envoy A forwards to B's inbox, pushes A</td>
<td><code>[{A, saga_1}]</code></td>
</tr>
<tr>
<td>3</td>
<td>Gateway B receives, forwards internally to Envoy B</td>
<td><code>[{A, saga_1}]</code></td>
</tr>
<tr>
<td>4</td>
<td>Envoy B forwards to C's inbox, pushes B</td>
<td><code>[{A, saga_1}, {B, saga_2}]</code></td>
</tr>
<tr>
<td>5</td>
<td>Gateway C receives, forwards to Responder</td>
<td><code>[{A, saga_1}, {B, saga_2}]</code></td>
</tr>
<tr>
<td>6</td>
<td>Responder processes, sends response</td>
<td><code>[{A, saga_1}, {B, saga_2}]</code></td>
</tr>
<tr>
<td>7</td>
<td>Gateway C forwards response to B's inbox</td>
<td><code>[{A, saga_1}, {B, saga_2}]</code></td>
</tr>
<tr>
<td>8</td>
<td>Gateway B pops B, restores B's state, then to A</td>
<td><code>[{A, saga_1}]</code></td>
</tr>
<tr>
<td>9</td>
<td>Gateway A pops A, restores A's state</td>
<td><code>[]</code></td>
</tr>
</tbody>
</table>
<p><em>Note: <code>{A, saga_1}</code> represents <code>GuildStackEntry(guild_id="A", saga_id="saga_1")</code></em></p>
<h3 id="key-concepts">Key Concepts<a class="headerlink" href="#key-concepts" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Concept</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Shared Namespace</strong></td>
<td>Organization-level namespace where guild inboxes exist</td>
</tr>
<tr>
<td><strong>Guild Inbox</strong></td>
<td>Topic <code>guild_inbox:{guild_id}</code> where a guild receives cross-guild messages</td>
</tr>
<tr>
<td><strong>Origin Guild Stack</strong></td>
<td>Stack of <code>GuildStackEntry</code> objects tracking the chain of guilds for multi-hop response routing</td>
</tr>
<tr>
<td><strong>GuildStackEntry</strong></td>
<td>Contains <code>guild_id</code> for routing and optional <code>saga_id</code> for session state preservation</td>
</tr>
<tr>
<td><strong>Saga Pattern</strong></td>
<td>Automatic preservation of <code>session_state</code> across G2G boundaries using saga IDs</td>
</tr>
<tr>
<td><strong>Boundary Agent</strong></td>
<td>Base class for agents that communicate across guild boundaries</td>
</tr>
</tbody>
</table>
<h2 id="core-components">Core Components<a class="headerlink" href="#core-components" title="Permanent link">&para;</a></h2>
<h3 id="boundaryagent">BoundaryAgent<a class="headerlink" href="#boundaryagent" title="Permanent link">&para;</a></h3>
<p><code>BoundaryAgent</code> is the base class for agents that participate in cross-guild communication. It provides:</p>
<ul>
<li>Optional subscription to the guild's shared inbox</li>
<li>Base class for GatewayAgent and EnvoyAgent</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.guild.g2g</span><span class="w"> </span><span class="kn">import</span> <span class="n">BoundaryAgent</span><span class="p">,</span> <span class="n">BoundaryAgentProps</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">BoundaryAgentProps</span><span class="p">(</span><span class="n">BaseAgentProps</span><span class="p">):</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base properties for boundary agents.</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="sd">    This is a marker base class. Subclasses (GatewayAgentProps, EnvoyAgentProps)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="sd">    define their own format filtering properties.</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="k">pass</span>
</code></pre></div>
<h3 id="gatewayagent">GatewayAgent<a class="headerlink" href="#gatewayagent" title="Permanent link">&para;</a></h3>
<p><code>GatewayAgent</code> acts as the <strong>server-side</strong> entry point for cross-guild communication. It:</p>
<ol>
<li>Receives requests from external guilds via the shared inbox</li>
<li>Forwards requests internally for processing</li>
<li>Catches responses and routes them back through the guild chain</li>
<li>Handles returned responses from external guilds</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.guild.g2g</span><span class="w"> </span><span class="kn">import</span> <span class="n">GatewayAgent</span><span class="p">,</span> <span class="n">GatewayAgentProps</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="c1"># Configure a gateway</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">gateway_spec</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">AgentBuilder</span><span class="p">(</span><span class="n">GatewayAgent</span><span class="p">)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="o">.</span><span class="n">set_id</span><span class="p">(</span><span class="s2">&quot;gateway&quot;</span><span class="p">)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;Gateway&quot;</span><span class="p">)</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s2">&quot;Receives cross-guild requests&quot;</span><span class="p">)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    <span class="o">.</span><span class="n">set_properties</span><span class="p">(</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        <span class="n">GatewayAgentProps</span><span class="p">(</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>            <span class="n">input_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Request&quot;</span><span class="p">],</span>      <span class="c1"># Accept these formats as requests</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>            <span class="n">output_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Response&quot;</span><span class="p">],</span>    <span class="c1"># Forward these formats back</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>            <span class="n">returned_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Response&quot;</span><span class="p">],</span>  <span class="c1"># Accept these as returned responses</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>        <span class="p">)</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="p">)</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    <span class="o">.</span><span class="n">build_spec</span><span class="p">()</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="p">)</span>
</code></pre></div>
<h4 id="gatewayagent-message-handlers">GatewayAgent Message Handlers<a class="headerlink" href="#gatewayagent-message-handlers" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Handler</th>
<th>Trigger</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>handle_inbound_request</code></td>
<td>Message from shared inbox, not this guild at stack top</td>
<td>Forward internally for processing</td>
</tr>
<tr>
<td><code>handle_returned_response</code></td>
<td>Message from shared inbox, this guild at stack top</td>
<td>Pop stack, forward internally (allows processing), then <code>handle_outbound</code> routes it</td>
</tr>
<tr>
<td><code>handle_outbound</code></td>
<td>Internal message with origin stack, this guild NOT at top</td>
<td>Forward to previous guild in chain</td>
</tr>
</tbody>
</table>
<h4 id="automatic-gatewayagent-via-gatewayconfig">Automatic GatewayAgent via GatewayConfig<a class="headerlink" href="#automatic-gatewayagent-via-gatewayconfig" title="Permanent link">&para;</a></h4>
<p>Instead of manually creating a <code>GatewayAgent</code> with <code>AgentBuilder</code>, you can use <code>GatewayConfig</code> with <code>GuildBuilder.set_gateway()</code> for automatic gateway creation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.guild.builders</span><span class="w"> </span><span class="kn">import</span> <span class="n">GuildBuilder</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.guild.dsl</span><span class="w"> </span><span class="kn">import</span> <span class="n">GatewayConfig</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1"># Automatic gateway setup</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">guild</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="n">GuildBuilder</span><span class="p">(</span><span class="n">guild_name</span><span class="o">=</span><span class="s2">&quot;my_guild&quot;</span><span class="p">,</span> <span class="n">guild_description</span><span class="o">=</span><span class="s2">&quot;My Guild&quot;</span><span class="p">)</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="o">.</span><span class="n">set_messaging</span><span class="p">(</span><span class="s2">&quot;rustic_ai.core.messaging.backend&quot;</span><span class="p">,</span> <span class="s2">&quot;InMemoryMessagingBackend&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="o">.</span><span class="n">set_gateway</span><span class="p">(</span><span class="n">GatewayConfig</span><span class="p">(</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>        <span class="n">input_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Request&quot;</span><span class="p">],</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        <span class="n">output_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Response&quot;</span><span class="p">],</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>        <span class="n">returned_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Result&quot;</span><span class="p">],</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="p">))</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="o">.</span><span class="n">bootstrap</span><span class="p">(</span><span class="n">database_url</span><span class="p">,</span> <span class="n">org_id</span><span class="p">)</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="p">)</span>
</code></pre></div>
<p>This automatically creates a <code>GatewayAgent</code> with ID <code>"gateway"</code> when <code>build_spec()</code> is called.</p>
<p><strong>GatewayConfig Properties:</strong></p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>enabled</code></td>
<td><code>bool</code></td>
<td><code>True</code></td>
<td>Whether to create the automatic gateway</td>
</tr>
<tr>
<td><code>input_formats</code></td>
<td><code>List[str]</code></td>
<td>(required)</td>
<td>Formats to accept as inbound requests</td>
</tr>
<tr>
<td><code>output_formats</code></td>
<td><code>List[str]</code></td>
<td>(required)</td>
<td>Formats to forward back as responses</td>
</tr>
<tr>
<td><code>returned_formats</code></td>
<td><code>List[str]</code></td>
<td><code>[]</code></td>
<td>Formats to accept as returned responses</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note</strong>: If a <code>GatewayAgent</code> already exists in the agents list, <code>GatewayConfig</code> will not create a duplicate.</p>
</blockquote>
<h3 id="envoyagent">EnvoyAgent<a class="headerlink" href="#envoyagent" title="Permanent link">&para;</a></h3>
<p><code>EnvoyAgent</code> acts as the <strong>client-side</strong> sender for cross-guild communication. It:</p>
<ol>
<li>Listens for messages on configured topics</li>
<li>Forwards matching messages to a target guild's inbox</li>
<li>Pushes the current guild onto the <code>origin_guild_stack</code> for return routing</li>
</ol>
<p><code>EnvoyAgentProps</code> has two properties:
- <code>target_guild</code> (required): The destination guild ID
- <code>formats_to_forward</code> (required): Message formats to forward</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.guild.g2g</span><span class="w"> </span><span class="kn">import</span> <span class="n">EnvoyAgent</span><span class="p">,</span> <span class="n">EnvoyAgentProps</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1"># Configure an envoy to send to another guild</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">envoy_spec</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="n">AgentBuilder</span><span class="p">(</span><span class="n">EnvoyAgent</span><span class="p">)</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="o">.</span><span class="n">set_id</span><span class="p">(</span><span class="s2">&quot;envoy&quot;</span><span class="p">)</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;Envoy&quot;</span><span class="p">)</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s2">&quot;Sends requests to Guild B&quot;</span><span class="p">)</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="o">.</span><span class="n">set_properties</span><span class="p">(</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>        <span class="n">EnvoyAgentProps</span><span class="p">(</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>            <span class="n">target_guild</span><span class="o">=</span><span class="s2">&quot;guild-b-id&quot;</span><span class="p">,</span>           <span class="c1"># Destination guild (required)</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>            <span class="n">formats_to_forward</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Request&quot;</span><span class="p">],</span> <span class="c1"># Required: formats to forward</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>        <span class="p">)</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="p">)</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    <span class="o">.</span><span class="n">add_additional_topic</span><span class="p">(</span><span class="s2">&quot;outbound&quot;</span><span class="p">)</span>  <span class="c1"># Listen on this topic</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>    <span class="o">.</span><span class="n">build_spec</span><span class="p">()</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="p">)</span>
</code></pre></div>
<h3 id="boundarycontext">BoundaryContext<a class="headerlink" href="#boundarycontext" title="Permanent link">&para;</a></h3>
<p><code>BoundaryContext</code> extends <code>ProcessContext</code> with cross-guild messaging capabilities:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">BoundaryContext</span><span class="p">(</span><span class="n">ProcessContext</span><span class="p">):</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Context for boundary agent processors.&quot;&quot;&quot;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_guild_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Forward a message to another guild&#39;s inbox.</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="sd">        Pushes the current guild onto origin_guild_stack for return routing.</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>        <span class="o">...</span>
</code></pre></div>
<h3 id="boundaryclient">BoundaryClient<a class="headerlink" href="#boundaryclient" title="Permanent link">&para;</a></h3>
<p><code>BoundaryClient</code> wraps a regular client with shared namespace publishing. It is used internally by <code>BoundaryContext</code> and is typically not used directly.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.messaging.core.boundary_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">BoundaryClient</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">BoundaryClient</span><span class="p">:</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper around Client that adds shared namespace capabilities.&quot;&quot;&quot;</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner_client</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span> <span class="n">organization_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>        <span class="o">...</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">publish_to_guild_inbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_guild_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Publish a message to a guild&#39;s inbox in the shared namespace.&quot;&quot;&quot;</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>        <span class="o">...</span>
</code></pre></div>
<h2 id="multi-hop-routing-with-origin-guild-stack">Multi-Hop Routing with Origin Guild Stack<a class="headerlink" href="#multi-hop-routing-with-origin-guild-stack" title="Permanent link">&para;</a></h2>
<p>The <code>origin_guild_stack</code> field on <code>Message</code> enables responses to route back through a chain of guilds. This is essential for scenarios like A  B  C  B  A.</p>
<h3 id="how-the-stack-works">How the Stack Works<a class="headerlink" href="#how-the-stack-works" title="Permanent link">&para;</a></h3>
<p>Each entry in the stack is a <code>GuildStackEntry</code> containing the guild ID and an optional saga ID for session state preservation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>Forward Path (Request):
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>  A sends to B    stack becomes [{guild_id: A, saga_id: ...}]
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>  B sends to C    stack becomes [{guild_id: A, saga_id: ...}, {guild_id: B, saga_id: ...}]
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>Return Path (Response):
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>  C responds      stack is [{guild_id: A, saga_id: ...}, {guild_id: B, saga_id: ...}]
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>  C&#39;s Gateway forwards to B (stack top)
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>  B&#39;s Gateway pops B, restores B&#39;s state    stack becomes [{guild_id: A, saga_id: ...}]
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>  B&#39;s Gateway forwards to A (stack top)
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>  A&#39;s Gateway pops A, restores A&#39;s state    stack becomes []
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>  Round-trip complete with session state preserved!
</code></pre></div>
<h3 id="stack-operations">Stack Operations<a class="headerlink" href="#stack-operations" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Operation</th>
<th>When</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Push</strong></td>
<td>Envoy forwards OUT</td>
<td>Adds current guild to stack</td>
</tr>
<tr>
<td><strong>Pop</strong></td>
<td>Gateway receives returned response</td>
<td>Removes top (current guild) from stack</td>
</tr>
<tr>
<td><strong>Read Top</strong></td>
<td>Gateway routing decision</td>
<td>Determines next hop or if internal</td>
</tr>
</tbody>
</table>
<h3 id="multi-hop-flow-diagram">Multi-Hop Flow Diagram<a class="headerlink" href="#multi-hop-flow-diagram" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>sequenceDiagram
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    participant A as Guild A&lt;br/&gt;(Client)
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    participant B as Guild B&lt;br/&gt;(Middle)
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    participant C as Guild C&lt;br/&gt;(Backend)
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    Note over A,C: Forward Path (Request)
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    A-&gt;&gt;A: Agent sends request
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    A-&gt;&gt;A: Envoy A picks up, pushes A
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    A-&gt;&gt;B:  guild_inbox:B [stack: A]
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    B-&gt;&gt;B: Gateway B forwards internally
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    B-&gt;&gt;B: Envoy B picks up, pushes B
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>    B-&gt;&gt;C:  guild_inbox:C [stack: A, B]
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    C-&gt;&gt;C: Gateway C forwards internally
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>    C-&gt;&gt;C: Processor handles request
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>    Note over A,C: Return Path (Response)
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>    C-&gt;&gt;C: Processor sends response
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>    C-&gt;&gt;C: Gateway C handle_outbound
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>    C-&gt;&gt;B:  guild_inbox:B [stack: A, B]
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>    B-&gt;&gt;B: Gateway B pops B, forwards internally
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>    B-&gt;&gt;B: Processors see response [stack: A]
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>    B-&gt;&gt;B: Gateway B handle_outbound
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>    B-&gt;&gt;A:  guild_inbox:A [stack: A]
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>    A-&gt;&gt;A: Gateway A pops A, forwards internally
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>    A-&gt;&gt;A: Processors see response [stack: empty]
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>    Note over A: Round-trip complete!
</code></pre></div>
<h2 id="message-format-filtering">Message Format Filtering<a class="headerlink" href="#message-format-filtering" title="Permanent link">&para;</a></h2>
<p>Gateways and Envoys support format-based filtering to control what types of messages flow across guild boundaries.</p>
<h3 id="gatewayagent-formats">GatewayAgent Formats<a class="headerlink" href="#gatewayagent-formats" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">GatewayAgentProps</span><span class="p">(</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="n">input_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Request&quot;</span><span class="p">,</span> <span class="s2">&quot;myapp.messages.Query&quot;</span><span class="p">],</span>   <span class="c1"># Accept as inbound requests</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="n">output_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Response&quot;</span><span class="p">,</span> <span class="s2">&quot;myapp.messages.Result&quot;</span><span class="p">],</span> <span class="c1"># Forward back as responses</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="n">returned_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Response&quot;</span><span class="p">],</span>              <span class="c1"># Accept as returned responses</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Property</th>
<th>Purpose</th>
<th>Empty Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>input_formats</code></td>
<td>Filter incoming requests from external guilds</td>
<td><strong>Deny all</strong>. Explicit formats recommended. <code>["*"]</code> allows all (use with caution).</td>
</tr>
<tr>
<td><code>output_formats</code></td>
<td>Filter outgoing responses back to origin</td>
<td><strong>Deny all</strong>. Explicit formats recommended. <code>["*"]</code> allows all (use with caution).</td>
</tr>
<tr>
<td><code>returned_formats</code></td>
<td>Filter responses coming back from external guilds</td>
<td><strong>Deny all</strong>. Explicit formats recommended. <code>["*"]</code> allows all (use with caution).</td>
</tr>
</tbody>
</table>
<h3 id="envoyagent-formats">EnvoyAgent Formats<a class="headerlink" href="#envoyagent-formats" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">EnvoyAgentProps</span><span class="p">(</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="n">target_guild</span><span class="o">=</span><span class="s2">&quot;guild-b-id&quot;</span><span class="p">,</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="n">formats_to_forward</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Request&quot;</span><span class="p">],</span>  <span class="c1"># Required. Explicit formats recommended.</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Property</th>
<th>Purpose</th>
<th>Empty Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>formats_to_forward</code></td>
<td>Filter messages to forward to target guild</td>
<td><strong>Validation Error</strong> (Required field). Explicit formats recommended. <code>["*"]</code> allows all (use with caution).</td>
</tr>
</tbody>
</table>
<h2 id="security-access-control">Security &amp; Access Control<a class="headerlink" href="#security-access-control" title="Permanent link">&para;</a></h2>
<p>G2G provides security through format filtering and namespace isolation:</p>
<h3 id="1-format-filtering">1. Format Filtering<a class="headerlink" href="#1-format-filtering" title="Permanent link">&para;</a></h3>
<p>Restrict message types at boundaries. Empty format lists deny all messages by default:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># Gateway: Control inbound and outbound formats</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">GatewayAgentProps</span><span class="p">(</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="n">input_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Request&quot;</span><span class="p">],</span>    <span class="c1"># Accept these as inbound requests</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="n">output_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Response&quot;</span><span class="p">],</span>  <span class="c1"># Forward these back as responses</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">returned_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Result&quot;</span><span class="p">],</span>  <span class="c1"># Accept these as returned responses</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="p">)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="c1"># Envoy: Control what gets forwarded</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="n">EnvoyAgentProps</span><span class="p">(</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>    <span class="n">target_guild</span><span class="o">=</span><span class="s2">&quot;guild-b-id&quot;</span><span class="p">,</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    <span class="n">formats_to_forward</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Request&quot;</span><span class="p">],</span>  <span class="c1"># Required: explicit formats only</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="p">)</span>
</code></pre></div>
<blockquote>
<p><strong>Important</strong>: Empty format lists deny all messages. Always specify explicit formats.</p>
</blockquote>
<h3 id="2-organization-namespace-isolation">2. Organization Namespace Isolation<a class="headerlink" href="#2-organization-namespace-isolation" title="Permanent link">&para;</a></h3>
<p>Cross-guild communication only works within the same organization. The shared namespace is scoped to <code>organization_id</code>.</p>
<h2 id="complete-example-two-guild-communication">Complete Example: Two-Guild Communication<a class="headerlink" href="#complete-example-two-guild-communication" title="Permanent link">&para;</a></h2>
<h3 id="guild-a-client">Guild A (Client)<a class="headerlink" href="#guild-a-client" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.guild.builders</span><span class="w"> </span><span class="kn">import</span> <span class="n">GuildBuilder</span><span class="p">,</span> <span class="n">AgentBuilder</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.guild.g2g</span><span class="w"> </span><span class="kn">import</span> <span class="n">GatewayAgent</span><span class="p">,</span> <span class="n">GatewayAgentProps</span><span class="p">,</span> <span class="n">EnvoyAgent</span><span class="p">,</span> <span class="n">EnvoyAgentProps</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="c1"># Build Guild A</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">guild_a</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="n">GuildBuilder</span><span class="p">(</span><span class="n">guild_name</span><span class="o">=</span><span class="s2">&quot;client_guild&quot;</span><span class="p">,</span> <span class="n">guild_description</span><span class="o">=</span><span class="s2">&quot;Client&quot;</span><span class="p">)</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>    <span class="o">.</span><span class="n">set_messaging</span><span class="p">(</span><span class="s2">&quot;rustic_ai.core.messaging.backend&quot;</span><span class="p">,</span> <span class="s2">&quot;InMemoryMessagingBackend&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>    <span class="o">.</span><span class="n">bootstrap</span><span class="p">(</span><span class="n">database_url</span><span class="p">,</span> <span class="n">org_id</span><span class="p">)</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="p">)</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="c1"># Gateway to receive responses</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="n">gateway_a</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    <span class="n">AgentBuilder</span><span class="p">(</span><span class="n">GatewayAgent</span><span class="p">)</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>    <span class="o">.</span><span class="n">set_id</span><span class="p">(</span><span class="s2">&quot;gateway_a&quot;</span><span class="p">)</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>    <span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;GatewayA&quot;</span><span class="p">)</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>    <span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="n">GatewayAgentProps</span><span class="p">(</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>        <span class="n">returned_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Response&quot;</span><span class="p">],</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>    <span class="p">))</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>    <span class="o">.</span><span class="n">build_spec</span><span class="p">()</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="p">)</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="n">guild_a</span><span class="o">.</span><span class="n">_add_local_agent</span><span class="p">(</span><span class="n">gateway_a</span><span class="p">)</span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="c1"># Envoy to send requests to Guild B</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="n">envoy_a</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>    <span class="n">AgentBuilder</span><span class="p">(</span><span class="n">EnvoyAgent</span><span class="p">)</span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>    <span class="o">.</span><span class="n">set_id</span><span class="p">(</span><span class="s2">&quot;envoy_a&quot;</span><span class="p">)</span>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>    <span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;EnvoyA&quot;</span><span class="p">)</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>    <span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="n">EnvoyAgentProps</span><span class="p">(</span>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>        <span class="n">target_guild</span><span class="o">=</span><span class="n">guild_b</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>        <span class="n">formats_to_forward</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Request&quot;</span><span class="p">],</span>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>    <span class="p">))</span>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>    <span class="o">.</span><span class="n">add_additional_topic</span><span class="p">(</span><span class="s2">&quot;outbound&quot;</span><span class="p">)</span>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>    <span class="o">.</span><span class="n">build_spec</span><span class="p">()</span>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a><span class="p">)</span>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="n">guild_a</span><span class="o">.</span><span class="n">_add_local_agent</span><span class="p">(</span><span class="n">envoy_a</span><span class="p">)</span>
</code></pre></div>
<h3 id="guild-b-server">Guild B (Server)<a class="headerlink" href="#guild-b-server" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># Build Guild B</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">guild_b</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="n">GuildBuilder</span><span class="p">(</span><span class="n">guild_name</span><span class="o">=</span><span class="s2">&quot;server_guild&quot;</span><span class="p">,</span> <span class="n">guild_description</span><span class="o">=</span><span class="s2">&quot;Server&quot;</span><span class="p">)</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="o">.</span><span class="n">set_messaging</span><span class="p">(</span><span class="s2">&quot;rustic_ai.core.messaging.backend&quot;</span><span class="p">,</span> <span class="s2">&quot;InMemoryMessagingBackend&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="o">.</span><span class="n">bootstrap</span><span class="p">(</span><span class="n">database_url</span><span class="p">,</span> <span class="n">org_id</span><span class="p">)</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="p">)</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="c1"># Gateway to receive requests and route responses</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="n">gateway_b</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>    <span class="n">AgentBuilder</span><span class="p">(</span><span class="n">GatewayAgent</span><span class="p">)</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>    <span class="o">.</span><span class="n">set_id</span><span class="p">(</span><span class="s2">&quot;gateway_b&quot;</span><span class="p">)</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>    <span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;GatewayB&quot;</span><span class="p">)</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>    <span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="n">GatewayAgentProps</span><span class="p">(</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>        <span class="n">input_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Request&quot;</span><span class="p">],</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>        <span class="n">output_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myapp.messages.Response&quot;</span><span class="p">],</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>    <span class="p">))</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>    <span class="o">.</span><span class="n">build_spec</span><span class="p">()</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="p">)</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="n">guild_b</span><span class="o">.</span><span class="n">_add_local_agent</span><span class="p">(</span><span class="n">gateway_b</span><span class="p">)</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="c1"># Add your processing agents...</span>
</code></pre></div>
<h3 id="sending-a-request">Sending a Request<a class="headerlink" href="#sending-a-request" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># From an agent in Guild A, publish to the outbound topic</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">ctx</span><span class="o">.</span><span class="n">send_dict</span><span class="p">(</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span><span class="p">,</span> <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">},</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;myapp.messages.Request&quot;</span><span class="p">,</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    <span class="n">topics</span><span class="o">=</span><span class="s2">&quot;outbound&quot;</span><span class="p">,</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="p">)</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="c1"># Flow:</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="c1"># 1. Envoy A picks up message on &quot;outbound&quot; topic</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="c1"># 2. Envoy A forwards to Guild B&#39;s inbox (pushes A onto stack)</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="c1"># 3. Gateway B receives, forwards internally</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="c1"># 4. Processing agent in B handles request, sends response</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="c1"># 5. Gateway B&#39;s handle_outbound catches response, forwards to A</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="c1"># 6. Gateway A receives, pops stack, forwards internally</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="c1"># 7. Original sender receives response</span>
</code></pre></div>
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<h3 id="1-use-specific-format-names">1. Use Specific Format Names<a class="headerlink" href="#1-use-specific-format-names" title="Permanent link">&para;</a></h3>
<p>Instead of generic formats, use descriptive names that indicate the message purpose:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Good</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">formats_to_forward</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;research.messages.Query&quot;</span><span class="p">,</span> <span class="s2">&quot;research.messages.Result&quot;</span><span class="p">]</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1"># Avoid</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">formats_to_forward</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">]</span>
</code></pre></div>
<h3 id="2-configure-both-sides">2. Configure Both Sides<a class="headerlink" href="#2-configure-both-sides" title="Permanent link">&para;</a></h3>
<p>Ensure both the sending and receiving guilds have compatible configurations:</p>
<ul>
<li>Envoy's <code>formats_to_forward</code> should match Gateway's <code>input_formats</code></li>
<li>Gateway's <code>output_formats</code> should match what the origin expects in <code>returned_formats</code></li>
</ul>
<h3 id="3-use-explicit-format-filters">3. Use Explicit Format Filters<a class="headerlink" href="#3-use-explicit-format-filters" title="Permanent link">&para;</a></h3>
<p>Always configure explicit format filters in production:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># Production gateway</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">GatewayAgentProps</span><span class="p">(</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="n">input_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;api.v1.Request&quot;</span><span class="p">],</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="n">output_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;api.v1.Response&quot;</span><span class="p">],</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="n">returned_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;api.v1.Result&quot;</span><span class="p">],</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="p">)</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="c1"># Production envoy</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="n">EnvoyAgentProps</span><span class="p">(</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>    <span class="n">target_guild</span><span class="o">=</span><span class="s2">&quot;backend-guild-id&quot;</span><span class="p">,</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>    <span class="n">formats_to_forward</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;api.v1.Request&quot;</span><span class="p">],</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="p">)</span>
</code></pre></div>
<h3 id="4-handle-errors-at-boundaries">4. Handle Errors at Boundaries<a class="headerlink" href="#4-handle-errors-at-boundaries" title="Permanent link">&para;</a></h3>
<p>Consider adding error handling agents that can catch and transform errors before they cross guild boundaries.</p>
<h3 id="5-monitor-cross-guild-traffic">5. Monitor Cross-Guild Traffic<a class="headerlink" href="#5-monitor-cross-guild-traffic" title="Permanent link">&para;</a></h3>
<p>The <code>origin_guild_stack</code> provides visibility into message routing. Log this for debugging:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nd">@agent</span><span class="o">.</span><span class="n">processor</span><span class="p">(</span><span class="n">JsonDict</span><span class="p">)</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">handle_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">ProcessContext</span><span class="p">):</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    <span class="n">stack_info</span> <span class="o">=</span> <span class="p">[(</span><span class="n">e</span><span class="o">.</span><span class="n">guild_id</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">saga_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">origin_guild_stack</span><span class="p">]</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message from guild chain: </span><span class="si">{</span><span class="n">stack_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="6-use-session-state-for-request-response-correlation">6. Use Session State for Request-Response Correlation<a class="headerlink" href="#6-use-session-state-for-request-response-correlation" title="Permanent link">&para;</a></h3>
<p>Instead of manual correlation tracking, leverage the automatic saga pattern:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Good: Use session_state for automatic correlation</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">ctx</span><span class="o">.</span><span class="n">send_dict</span><span class="p">(</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>    <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;search term&quot;</span><span class="p">},</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;myapp.messages.Request&quot;</span><span class="p">,</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    <span class="n">topics</span><span class="o">=</span><span class="s2">&quot;outbound&quot;</span><span class="p">,</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    <span class="n">session_state</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;correlation_id&quot;</span><span class="p">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span> <span class="s2">&quot;user_context&quot;</span><span class="p">:</span> <span class="n">user_data</span><span class="p">},</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="p">)</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="c1"># Avoid: Manual correlation tracking</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="c1"># correlation_store[message_id] = {&quot;correlation_id&quot;: &quot;abc123&quot;, ...}</span>
</code></pre></div>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="message-not-reaching-target-guild">Message Not Reaching Target Guild<a class="headerlink" href="#message-not-reaching-target-guild" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Check Envoy subscription</strong>: Ensure Envoy is listening on the correct topic</li>
<li><strong>Check format filtering</strong>: Verify <code>formats_to_forward</code> includes the message format</li>
<li><strong>Check target guild</strong>: Verify <code>target_guild</code> ID is correct</li>
</ol>
<h3 id="response-not-returning">Response Not Returning<a class="headerlink" href="#response-not-returning" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Check Gateway configuration</strong>: Verify <code>output_formats</code> includes the response format</li>
<li><strong>Check origin stack</strong>: Ensure the response has <code>origin_guild_stack</code> populated</li>
<li><strong>Check returned_formats</strong>: Origin guild's Gateway must accept the response format</li>
<li><strong>Check internal routing</strong>: Ensure the response reaches the Gateway internally</li>
</ol>
<h3 id="multi-hop-routing-issues">Multi-Hop Routing Issues<a class="headerlink" href="#multi-hop-routing-issues" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Stack ordering</strong>: Stack should be <code>[first_guild, second_guild, ...]</code> (first pushed at index 0)</li>
<li><strong>Intermediate processing</strong>: Each intermediate guild's Gateway must handle <code>returned_formats</code></li>
<li><strong>Stack inspection</strong>: Log <code>origin_guild_stack</code> at each hop to trace routing</li>
</ol>
<h2 id="saga-pattern-session-state-preservation">Saga Pattern: Session State Preservation<a class="headerlink" href="#saga-pattern-session-state-preservation" title="Permanent link">&para;</a></h2>
<p>When a message crosses guild boundaries, any <code>session_state</code> attached to the message is automatically preserved and restored when the response returns. This enables stateful request-response patterns without manual correlation tracking.</p>
<h3 id="how-it-works">How It Works<a class="headerlink" href="#how-it-works" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>EnvoyAgent</strong> captures the outbound message's <code>session_state</code> and saves it with a unique <code>saga_id</code></li>
<li>The <code>saga_id</code> is stored in the <code>origin_guild_stack</code> alongside the guild ID</li>
<li><strong>GatewayAgent</strong> restores the saved <code>session_state</code> when the response returns</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>sequenceDiagram
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    participant A as Guild A Agent
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>    participant E as Guild A Envoy
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    participant G as Guild B Gateway
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    participant P as Guild B Processor
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>    A-&gt;&gt;E: Request with session_state
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>    Note over E: Save session_state with saga_id
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>    E-&gt;&gt;G: Forward (stack includes saga_id)
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>    G-&gt;&gt;P: Process request
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>    P-&gt;&gt;G: Send response
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>    G-&gt;&gt;E: Response returns
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>    Note over E: Restore session_state from saga_id
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>    E-&gt;&gt;A: Response with original session_state
</code></pre></div>
<h3 id="guildstackentry-structure">GuildStackEntry Structure<a class="headerlink" href="#guildstackentry-structure" title="Permanent link">&para;</a></h3>
<p>The <code>origin_guild_stack</code> uses <code>GuildStackEntry</code> objects instead of plain strings:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.messaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">GuildStackEntry</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="c1"># Each entry in the stack contains:</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">GuildStackEntry</span><span class="p">(</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    <span class="n">guild_id</span><span class="o">=</span><span class="s2">&quot;source-guild-id&quot;</span><span class="p">,</span>  <span class="c1"># The guild ID for routing</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>    <span class="n">saga_id</span><span class="o">=</span><span class="s2">&quot;unique-saga-id&quot;</span><span class="p">,</span>    <span class="c1"># Optional: ID for session state lookup</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="p">)</span>
</code></pre></div>
<h3 id="usage-example">Usage Example<a class="headerlink" href="#usage-example" title="Permanent link">&para;</a></h3>
<p>Session state is automatically preserved when you include it in your outbound message:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nd">@agent</span><span class="o">.</span><span class="n">processor</span><span class="p">(</span><span class="n">QueryRequest</span><span class="p">)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">initiate_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">ProcessContext</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">QueryRequest</span><span class="p">):</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>    <span class="c1"># Save context that should be preserved across the G2G call</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>    <span class="n">ctx</span><span class="o">.</span><span class="n">send_dict</span><span class="p">(</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>        <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">query</span><span class="p">},</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;myapp.messages.Request&quot;</span><span class="p">,</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>        <span class="n">topics</span><span class="o">=</span><span class="s2">&quot;outbound&quot;</span><span class="p">,</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>        <span class="n">session_state</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>            <span class="s2">&quot;correlation_id&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">correlation_id</span><span class="p">,</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>            <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="s2">&quot;awaiting_response&quot;</span><span class="p">,</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>        <span class="p">}</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>    <span class="p">)</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="nd">@agent</span><span class="o">.</span><span class="n">processor</span><span class="p">(</span><span class="n">QueryResponse</span><span class="p">)</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="k">def</span><span class="w"> </span><span class="nf">handle_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">ProcessContext</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">QueryResponse</span><span class="p">):</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>    <span class="c1"># session_state is automatically restored!</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>    <span class="n">state</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">session_state</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>    <span class="n">user_id</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>    <span class="n">correlation_id</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;correlation_id&quot;</span><span class="p">)</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>    <span class="c1"># Continue processing with original context</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, correlation </span><span class="si">{</span><span class="n">correlation_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="key-points">Key Points<a class="headerlink" href="#key-points" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Automatic</strong></td>
<td>No explicit correlation tracking needed</td>
</tr>
<tr>
<td><strong>Non-empty Only</strong></td>
<td>State is only saved if <code>session_state</code> is not empty</td>
</tr>
<tr>
<td><strong>Restored on Return</strong></td>
<td>State is restored when response crosses back into origin guild</td>
</tr>
<tr>
<td><strong>Multi-hop Support</strong></td>
<td>Each hop in the chain preserves its own session state</td>
</tr>
<tr>
<td><strong>Cleanup</strong></td>
<td>Saga state is deleted after restoration (one-time use)</td>
</tr>
</tbody>
</table>
<h3 id="multi-hop-saga-state">Multi-Hop Saga State<a class="headerlink" href="#multi-hop-saga-state" title="Permanent link">&para;</a></h3>
<p>In multi-hop scenarios (A  B  C  B  A), each guild's session state is independently preserved:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>Request A  B:
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>  - A&#39;s Envoy saves A&#39;s session_state with saga_id_1
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>  - Stack: [{guild_id: A, saga_id: saga_id_1}]
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>Request B  C:
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>  - B&#39;s Envoy saves B&#39;s session_state with saga_id_2
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>  - Stack: [{guild_id: A, saga_id: saga_id_1}, {guild_id: B, saga_id: saga_id_2}]
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>Response C  B:
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>  - B&#39;s Gateway restores B&#39;s session_state from saga_id_2
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>  - Stack: [{guild_id: A, saga_id: saga_id_1}]
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>Response B  A:
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>  - A&#39;s Gateway restores A&#39;s session_state from saga_id_1
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>  - Stack: []
</code></pre></div>
<h3 id="low-level-api">Low-Level API<a class="headerlink" href="#low-level-api" title="Permanent link">&para;</a></h3>
<p>Saga state is managed through the guild's state system using <code>StateRefresherMixin</code>. The key helper function is available:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.guild.g2g</span><span class="w"> </span><span class="kn">import</span> <span class="n">SAGA_STATE_PREFIX</span><span class="p">,</span> <span class="n">get_saga_state_key</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.state.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateUpdateFormat</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="c1"># Generate the state key for a saga</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="n">saga_id</span> <span class="o">=</span> <span class="s2">&quot;custom-saga-id&quot;</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="n">state_key</span> <span class="o">=</span> <span class="n">get_saga_state_key</span><span class="p">(</span><span class="n">saga_id</span><span class="p">)</span>  <span class="c1"># Returns &quot;g2g_saga.custom-saga-id&quot;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="c1"># Save saga state (using StateRefresherMixin via agent)</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="bp">self</span><span class="o">.</span><span class="n">update_guild_state</span><span class="p">(</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>    <span class="n">ctx</span><span class="p">,</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>    <span class="n">update_format</span><span class="o">=</span><span class="n">StateUpdateFormat</span><span class="o">.</span><span class="n">JSON_MERGE_PATCH</span><span class="p">,</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>    <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="n">state_key</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;custom&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">}},</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="p">)</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="c1"># Retrieve saga state from agent&#39;s cached guild state</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guild_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">state_key</span><span class="p">)</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="c1"># Delete saga state (set to None via merge patch)</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="bp">self</span><span class="o">.</span><span class="n">update_guild_state</span><span class="p">(</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>    <span class="n">ctx</span><span class="p">,</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>    <span class="n">update_format</span><span class="o">=</span><span class="n">StateUpdateFormat</span><span class="o">.</span><span class="n">JSON_MERGE_PATCH</span><span class="p">,</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>    <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="n">state_key</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="p">)</span>
</code></pre></div>
<h2 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h2>
<h3 id="classes">Classes<a class="headerlink" href="#classes" title="Permanent link">&para;</a></h3>
<ul>
<li><code>BoundaryAgent</code> - Base class for boundary agents</li>
<li><code>BoundaryAgentProps</code> - Marker base class for boundary agent properties</li>
<li><code>GatewayAgent</code> - Server-side gateway</li>
<li><code>GatewayAgentProps</code> - Gateway properties (includes <code>input_formats</code>, <code>output_formats</code>, <code>returned_formats</code>)</li>
<li><code>GatewayConfig</code> (from <code>rustic_ai.core.guild.dsl</code>) - Configuration for automatic <code>GatewayAgent</code> creation via <code>GuildBuilder.set_gateway()</code></li>
<li><code>EnvoyAgent</code> - Client-side envoy</li>
<li><code>EnvoyAgentProps</code> - Envoy properties (includes <code>target_guild</code>, <code>formats_to_forward</code>)</li>
<li><code>BoundaryContext</code> - Cross-guild context with <code>forward_out()</code> method</li>
<li><code>BoundaryClient</code> (from <code>rustic_ai.core.messaging.core.boundary_client</code>) - Shared namespace client</li>
<li><code>GuildStackEntry</code> - Stack entry with <code>guild_id</code> and optional <code>saga_id</code></li>
</ul>
<h3 id="exported-from-rustic_aicoreguildg2g">Exported from <code>rustic_ai.core.guild.g2g</code><a class="headerlink" href="#exported-from-rustic_aicoreguildg2g" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rustic_ai.core.guild.g2g</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>    <span class="n">BoundaryAgent</span><span class="p">,</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    <span class="n">BoundaryAgentProps</span><span class="p">,</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="n">BoundaryContext</span><span class="p">,</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>    <span class="n">EnvoyAgent</span><span class="p">,</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    <span class="n">EnvoyAgentProps</span><span class="p">,</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>    <span class="n">GatewayAgent</span><span class="p">,</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>    <span class="n">GatewayAgentProps</span><span class="p">,</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>    <span class="n">GuildStackEntry</span><span class="p">,</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>    <span class="n">SAGA_STATE_PREFIX</span><span class="p">,</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>    <span class="n">get_saga_state_key</span><span class="p">,</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="p">)</span>
</code></pre></div>
<h3 id="message-fields">Message Fields<a class="headerlink" href="#message-fields" title="Permanent link">&para;</a></h3>
<ul>
<li><code>origin_guild_stack: List[GuildStackEntry]</code> - Stack tracking guild chain for response routing, with optional saga IDs for session state preservation</li>
</ul>
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../guilds/">Guilds</a> - Guild fundamentals</li>
<li><a href="../messaging/">Messaging</a> - Messaging system details</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
        <script src="../../assets/javascripts/mermaid-init.js"></script>
      
    
  </body>
</html>